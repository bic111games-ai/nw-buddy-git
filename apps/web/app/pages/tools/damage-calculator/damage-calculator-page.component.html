<ion-header class="bg-base-300">
  <ion-toolbar>
    <ion-title>Damage Calculator</ion-title>

    <div slot="end">
      <div class="join pr-1">
        <button
          class="join-item btn btn-square btn-ghost"
          [class.text-primary]="isChildActive()"
          (click)="isChildActive.set(!isChildActive())"
          [tooltip]="'Show calulations'"
        >
          <nwb-icon [icon]="iconFormula" class="w-4 h-4" />
        </button>
        <button class="join-item btn btn-square btn-ghost" (click)="copyLink()" [tooltip]="'Copy link'">
          <nwb-icon [icon]="iconLink" class="w-4 h-4" />
        </button>
        <button class="join-item btn btn-square btn-ghost" [nwbScreenshotBtn] [tooltip]="'Screenshot'"></button>
      </div>
    </div>
  </ion-toolbar>
</ion-header>
<ion-content [scrollY]="false">
  <ion-split-pane [when]="showSidebar()" contentId="main">
    <ion-menu
      contentId="main"
      class="order-3 min-w-80 max-w-1/2"
      [nwbSplitPane]="gutter"
      [nwbSplitPaneWidth]="1000"
      [nwbSplitPaneKey]="'detail-dmg-calc'"
    >
      @if (showSidebar()) {
        <ng-container [ngTemplateOutlet]="tplDetail" />
      }
    </ion-menu>
    <nwb-split-gutter class="order-2" #gutter="gutter" [class.hidden]="!showSidebar()" />
    <div class="ion-page order-1" id="main">
      <ion-content class="sm:ion-p-4">
        <div class="max-w-5xl mx-auto">
          <nwb-damage-calculator
            class="bg-base-300 sm:rounded-lg"
            standalone
            [nwbScreenshotFrame]="'Damage Formula'"
            [nwbScreenshotWidth]="1024"
            [state]="initialState"
            (stateChange)="handleStateChange($event)"
            #calculator
          />
        </div>
      </ion-content>
    </div>
  </ion-split-pane>
  <nwb-detail-content
    [isOpen]="showModal()"
    [initialBreakpoint]="100 | px2vh"
    [breakpoints]="[12 | px2vh, 100 | px2vh, 0.45, 1]"
    [backdropBreakpoint]="0.5"
    [backdropDismiss]="false"
    [template]="tplDetail"
    [size]="'x-lg'"
  />
</ion-content>

<ng-template #tplDetail>
  <ion-content [class.ion-p-4]="showSidebar()" [class.ion-p-2]="showModal()">
    <div [nwbScreenshotFrame]="'Damage Formula'" [nwbScreenshotWidth]="1024" class="bg-base-300 rounded-md">
      <ng-container [ngTemplateOutlet]="calculator.tplFormula()" />
    </div>
  </ion-content>
</ng-template>
